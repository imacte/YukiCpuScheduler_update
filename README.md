# YukiCpuScheduler (Yuki CPU è°ƒåº¦å™¨)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**YukiCpuScheduler æ˜¯ä¸€ä¸ªä¸º Android è®¾å¤‡è®¾è®¡çš„ã€é«˜åº¦å¯é…ç½®çš„åå°æœåŠ¡ï¼Œæ—¨åœ¨é€šè¿‡åŠ¨æ€è°ƒæ•´CPUé¢‘ç‡ã€è°ƒé€Ÿå™¨ã€Uclampã€Cpusetã€CPUäº²å’Œæ€§ï¼ˆåŒ…æ‹¬Cgroupçº§åˆ«å’Œæ–°å¢çš„çº¿ç¨‹çº§åˆ«ï¼‰ã€I/Oè°ƒåº¦å™¨å’ŒEASï¼ˆå¦‚æœå†…æ ¸æ”¯æŒï¼‰å‚æ•°ï¼Œæ¥ä¼˜åŒ–è®¾å¤‡æ€§èƒ½å’ŒåŠŸè€—è¡¨ç°ã€‚**

å®ƒç‰¹åˆ«å…³æ³¨äºæ ¹æ®å½“å‰è¿è¡Œçš„å‰å°åº”ç”¨ï¼ˆç°åœ¨å¯ä»¥æ›´ç²¾ç¡®åœ°ä½¿ç”¨PIDè¿›è¡Œè¯†åˆ«å’Œä¼˜åŒ–ï¼‰å’Œå±å¹•çŠ¶æ€æ¥åº”ç”¨ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼Œä»¥å®ç°åœ¨éœ€è¦é«˜æ€§èƒ½æ—¶ï¼ˆå¦‚æ¸¸æˆã€åº”ç”¨å¯åŠ¨ï¼‰æä¾›æµç•…ä½“éªŒï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ä¿æŒå‡è¡¡ï¼Œåœ¨è®¾å¤‡ç©ºé—²æˆ–æ¯å±æ—¶åˆ™å°½å¯èƒ½èŠ‚çœç”µé‡ã€‚

---

## âœ¨ ä¸»è¦ç‰¹æ€§ (Features)

* **å¤šæ¨¡å¼è°ƒåº¦ï¼š** æ”¯æŒé¢„å®šä¹‰å¤šç§æ€§èƒ½æ¨¡å¼ï¼ˆä¾‹å¦‚ `powersave`, `balance`, `performance`, `fast`ï¼‰ï¼Œå¹¶å¯æ ¹æ®å±å¹•çŠ¶æ€è‡ªåŠ¨åˆ‡æ¢ã€‚
* **åº”ç”¨ç‰¹å®šé…ç½®ï¼š** å…è®¸ç”¨æˆ·ä¸ºç‰¹å®šçš„åº”ç”¨ç¨‹åºï¼ˆé€šè¿‡åŒ…åè¯†åˆ«ï¼‰å®šä¹‰ä¸“å±çš„è°ƒåº¦æ¨¡å¼æˆ–è¦†ç›–æ¨¡å¼ä¸­çš„ä¸ªåˆ«å‚æ•°ã€‚
* **å…¨é¢çš„CPUå‚æ•°è°ƒæ•´ï¼š**
    * æ”¯æŒå¤šæ ¸å¿ƒç°‡æ¶æ„ (ä¾‹å¦‚ Small, Medium, Big, SuperBig Cores)ã€‚
    * å¯é…ç½®æ¯ä¸ªæ ¸å¿ƒç°‡çš„ CPU è°ƒé€Ÿå™¨ (governor)ï¼Œå¹¶æ”¯æŒå¤‡é€‰è°ƒé€Ÿå™¨æ–¹æ¡ˆã€‚
    * å¯é…ç½®æ¯ä¸ªæ ¸å¿ƒç°‡çš„æœ€å¤§å’Œæœ€å° CPU é¢‘ç‡ã€‚
    * å¯é…ç½®ç‰¹å®šè°ƒé€Ÿå™¨å‚æ•° (ä¾‹å¦‚ `schedutil` çš„ `up_rate_limit_us`, `down_rate_limit_us` ç­‰ï¼Œä»¥åŠå†…æ ¸ç‰¹æœ‰çš„å¦‚ `walt` å’Œ `uag` å­ç›®å½•ä¸‹çš„å‚æ•°)ã€‚
* **Uclamp æ§åˆ¶ï¼š** æ ¹æ®æ¨¡å¼å’Œåº”ç”¨è°ƒæ•´ cgroup çš„ `cpu.uclamp.min`, `cpu.uclamp.max` å’Œ `cpu.uclamp.latency_sensitive` (å¦‚æœå†…æ ¸æ”¯æŒ `cpu.uclamp.latency_sensitive` æˆ–ç±»ä¼¼çš„ `cpu.latency_sensitive`)ï¼Œä¸ºè°ƒåº¦å™¨æä¾›æ€§èƒ½éœ€æ±‚æç¤ºã€‚
* **Cpuset æ§åˆ¶ï¼š** ä¸ºä¸åŒçš„è¿›ç¨‹ç»„ (cgroups å¦‚ top-app, background) åˆ†é…ç‰¹å®šçš„ CPU æ ¸å¿ƒé›†ã€‚æ”¯æŒä½¿ç”¨æ ¸å¿ƒç±»å‹åç§°ï¼ˆå¦‚ "SmallCore", "BigCore"ï¼‰è¿›è¡Œé…ç½®ï¼Œå¹¶èƒ½ä¼˜é›…å¤„ç†è®¾å¤‡ä¸Šä¸å­˜åœ¨çš„å·²é…ç½®æ ¸å¿ƒç±»å‹ã€‚
* **CPU äº²å’Œæ€§è®¾ç½® (åŒå±‚çº§)ï¼š**
    * **ä¼ ç»ŸCgroupçº§åˆ«äº²å’Œæ€§ï¼š** ä¸ºç‰¹å®š cgroup å†…çš„è¿›ç¨‹è®¾ç½® CPU äº²å’Œæ€§ï¼Œå°†å®ƒä»¬ç»‘å®šåˆ°æŒ‡å®šçš„ CPU æ ¸å¿ƒä¸Šã€‚æ”¯æŒä½¿ç”¨æ ¸å¿ƒç±»å‹åç§°ã€‚
    * **æ–°å¢çº¿ç¨‹çº§åˆ«æ ¸å¿ƒåˆ†é…ï¼š** é€šè¿‡ `ThreadAffinityManager` å®ç°ï¼Œå…è®¸åŸºäºçº¿ç¨‹åç§°æ¨¡å¼æˆ–åŠ¨æ€CPUä½¿ç”¨ç‡ï¼Œä¸ºç‰¹å®šåº”ç”¨çš„çº¿ç¨‹ç»‘å®šåˆ°æŒ‡å®šçš„æ ¸å¿ƒæˆ–æ ¸å¿ƒç±»å‹ã€‚æ­¤åŠŸèƒ½å¯ç”¨æ—¶ï¼Œä¼šä¼˜å…ˆäºä¼ ç»Ÿçš„Cgroupçº§åˆ«äº²å’Œæ€§è®¾ç½®ã€‚
* **I/O è°ƒåº¦å™¨è°ƒæ•´ï¼š**
    * è‡ªåŠ¨æ£€æµ‹å—è®¾å¤‡ã€‚
    * è®¾ç½®æŒ‡å®šçš„ I/O è°ƒåº¦å™¨ (ä¾‹å¦‚ bfq, kyber)ã€‚
    * å¯é€‰çš„ I/O ä¼˜åŒ– (ä¾‹å¦‚è°ƒæ•´ `nomerges`)ã€‚
* **EAS (Energy Aware Scheduling) å‚æ•°è°ƒæ•´ï¼š** å¦‚æœå†…æ ¸æ”¯æŒï¼Œå¯ä»¥å†™å…¥è‡ªå®šä¹‰çš„ EAS ç›¸å…³ sysfs å‚æ•°ã€‚
* **åº”ç”¨å¯åŠ¨åŠ é€Ÿï¼š** å½“æ£€æµ‹åˆ°æ–°åº”ç”¨å¯åŠ¨åˆ°å‰å°æ—¶ï¼Œå¯ä»¥ä¸´æ—¶åˆ‡æ¢åˆ°é«˜æ€§èƒ½æ¨¡å¼ä»¥åŠ é€Ÿå¯åŠ¨è¿‡ç¨‹ï¼Œä¹‹åè‡ªåŠ¨æ¢å¤å¹¶è¿›å…¥å†·å´æœŸã€‚
* **é…ç½®æ–‡ä»¶çƒ­é‡è½½ï¼š** æœåŠ¡åœ¨è¿è¡Œæ—¶ä¼šç›‘è§†é…ç½®æ–‡ä»¶çš„æ›´æ”¹ï¼Œå¹¶åœ¨æ£€æµ‹åˆ°ä¿®æ”¹åè‡ªåŠ¨é‡æ–°åŠ è½½å¹¶åº”ç”¨æ–°çš„é…ç½®ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚
* **é«˜åº¦å¯é…ç½®ï¼š** é€šè¿‡ä¸»è¦çš„ INI é…ç½®æ–‡ä»¶ (`default_config.ini`, `app_profiles.ini`) ä»¥åŠå¯é€‰çš„å¤„ç†å™¨ç‰¹å®šé…ç½®æ–‡ä»¶ (ä¾‹å¦‚ `sm8650.ini`) è¿›è¡Œè¯¦ç»†å®šåˆ¶ã€‚
* **è¯¦ç»†æ—¥å¿—ï¼š** æ”¯æŒå¤šç§æ—¥å¿—çº§åˆ« (TRACE, DEBUG, INFO, WARN, ERROR, CRITICAL)ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥ã€‚
* **åå°å®ˆæŠ¤è¿›ç¨‹ï¼š** ä»¥rootæƒé™åœ¨åå°å®‰é™è¿è¡Œã€‚
* **è·¨å¹³å°æ„å»ºï¼š** ä½¿ç”¨ CMake å’Œ Android NDK æ„å»ºï¼Œç›®æ ‡ä¸º arm64-v8a (æˆ–å…¶ä»–ABI)ã€‚
* **æœåŠ¡å°±ç»ªæ¢æµ‹ï¼š** å¯åŠ¨æ—¶æ¢æµ‹å…³é”®ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ PowerManagerService, ActivityManagerServiceï¼‰æ˜¯å¦å°±ç»ªï¼Œä»¥å¢å¼ºç¨³å®šæ€§ã€‚

---

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

YukiCpuScheduler ä¸»è¦é€šè¿‡ä»¥ä¸‹ INI æ ¼å¼çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå®ƒä»¬é€šå¸¸ä½äº Magisk æ¨¡å—çš„ `/data/adb/modules/YukiCpuScheduler/configs/` ç›®å½• (æˆ–è€…ä½ åœ¨ CMakeLists.txt ä¸­æŒ‡å®šçš„æ¨¡å—è·¯å¾„ï¼Œæˆ–æœåŠ¡å¯åŠ¨æ—¶é€šè¿‡å‚æ•°æŒ‡å®šçš„è·¯å¾„)ï¼š

1.  **`default_config.ini`**: ä¸»é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†å…¨å±€è®¾ç½®ã€åŠŸèƒ½å¼€å…³ã€é»˜è®¤æ¨¡å¼ã€å„æ¨¡å¼ä¸‹çš„è¯¦ç»†å‚æ•°ã€cgroupè·¯å¾„ã€EASå‚æ•°ã€ä»¥åŠæ–°å¢çš„çº¿ç¨‹æ ¸å¿ƒåˆ†é…å…¨å±€è®¾ç½®ç­‰ã€‚
2.  **å¤„ç†å™¨ç‰¹å®šé…ç½®æ–‡ä»¶ (å¯é€‰)**: ä¾‹å¦‚ `sm8650.ini`, `sm8450.ini`ã€‚å¦‚æœå­˜åœ¨ä¸å½“å‰è®¾å¤‡å¤„ç†å™¨å‹å·åŒ¹é…çš„æ­¤ç±»æ–‡ä»¶ï¼ˆæ–‡ä»¶åéœ€ä¸æœåŠ¡è¯†åˆ«åˆ°çš„å¤„ç†å™¨å‹å·å­—ç¬¦ä¸²å®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬å¤§å°å†™å’Œç¬¦å·ï¼Œé€šå¸¸æ˜¯å°å†™å½¢å¼ï¼Œå¦‚ `sm8650.ini`ï¼‰ï¼Œå…¶é…ç½®å°†**è¦†ç›–** `default_config.ini` ä¸­çš„åŒåè®¾ç½®ã€‚æœåŠ¡å¯åŠ¨æ—¶ä¼šå°è¯•åŠ è½½ã€‚
3.  **`app_profiles.ini`**: åº”ç”¨ç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œç”¨äºä¸ºæŒ‡å®šçš„åº”ç”¨ç¨‹åºè¦†ç›–é»˜è®¤æ¨¡å¼æˆ–æ¨¡å¼ä¸­çš„å‚æ•°ï¼ŒåŒ…æ‹¬æ–°å¢çš„çº¿ç¨‹çº§åˆ«æ ¸å¿ƒåˆ†é…è§„åˆ™ã€‚æ­¤æ–‡ä»¶ä¸­çš„è®¾ç½®ä¼˜å…ˆçº§é«˜äºå¤„ç†å™¨ç‰¹å®šé…ç½®å’Œ `default_config.ini` ä¸­å…³äºåº”ç”¨è¡Œä¸ºçš„è®¾ç½®ã€‚

è¯¦ç»†çš„é…ç½®é¡¹è¯´æ˜å’Œç¤ºä¾‹è¯·å‚é˜…ä¸‹æ–¹çš„é…ç½®æŒ‡å—ç« èŠ‚ã€‚

---

## âš™ï¸ å¦‚ä½•æ‰‹åŠ¨é…ç½® `default_config.ini`

æœ¬èŠ‚è¯¦ç»†æŒ‡å¯¼æ‚¨å¦‚ä½•ä¿®æ”¹ `default_config.ini` æ–‡ä»¶ï¼ˆä»¥åŠå¯é€‰çš„å¤„ç†å™¨ç‰¹å®š `.ini` æ–‡ä»¶ï¼‰ã€‚å½“å­˜åœ¨ä¸å½“å‰è®¾å¤‡å¤„ç†å™¨å‹å·åŒ¹é…çš„ç‰¹å®šé…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ `sm8650.ini`ï¼Œä½äº `configs/` ç›®å½•ä¸‹ï¼‰æ—¶ï¼Œè¯¥ç‰¹å®šæ–‡ä»¶ä¸­çš„è®¾ç½®ä¼š**è¦†ç›–** `default_config.ini` ä¸­çš„åŒåè®¾ç½®ã€‚

**é‡è¦æç¤º:**

* **å¤‡ä»½**: åœ¨è¿›è¡Œä»»ä½•ä¿®æ”¹ä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®æ‚¨å¤‡ä»½åŸå§‹çš„é…ç½®æ–‡ä»¶ã€‚
* **è¯­æ³•**:
    * é…ç½®æ–‡ä»¶é‡‡ç”¨INIæ ¼å¼ï¼Œç”±å¤šä¸ª**èŠ‚ (Section)** ç»„æˆï¼ŒèŠ‚åç”¨æ–¹æ‹¬å· `[]` åŒ…å›´ï¼Œä¾‹å¦‚ `[meta]`ã€‚
    * æ¯ä¸ªèŠ‚ä¸‹é¢åŒ…å«å¤šä¸ª**é”®å€¼å¯¹ (Key-Value Pairs)**ï¼Œæ ¼å¼ä¸º `é”® = å€¼`ï¼Œä¾‹å¦‚ `loglevel = DEBUG`ã€‚
    * **æ³¨é‡Š**: ä»¥åˆ†å· `;` æˆ–äº•å· `#` å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Šè¡Œï¼Œå°†è¢«ç¨‹åºå¿½ç•¥ã€‚
    * **å€¼æ ¼å¼**:
        * é™¤éç‰¹åˆ«è¯´æ˜ï¼Œé…ç½®å€¼**ä¸åº”**åŒ…å«è‹±æ–‡åŒå¼•å· `""` æˆ–å•å¼•å· `''`ã€‚ç¨‹åºå†…éƒ¨ä¼šå¤„ç†é¦–å°¾ç©ºç™½å’Œå¼•å·ã€‚
        * å¸ƒå°”å€¼é€šå¸¸ä½¿ç”¨ `true` æˆ– `false` (ä¸åŒºåˆ†å¤§å°å†™)ã€‚
        * é¢‘ç‡å•ä½é€šå¸¸ä¸º `kHz` (åƒèµ«å…¹)ï¼Œä¾‹å¦‚ `1800000` ä»£è¡¨ 1.8GHzã€‚
        * æ—¶é—´å•ä½é€šå¸¸åœ¨é”®åä¸­æŒ‡æ˜ï¼Œä¾‹å¦‚ `Ms` (æ¯«ç§’) æˆ– `Sec` (ç§’)ã€‚
* **çƒ­é‡è½½**: ä¿®æ”¹ `default_config.ini` åï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨æ£€æµ‹æ›´æ”¹å¹¶çƒ­é‡è½½é…ç½®ã€‚å¦‚æœä¿®æ”¹äº†å¤„ç†å™¨ç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œå»ºè®®é‡å¯æœåŠ¡ä»¥ç¡®ä¿æ›´æ”¹å®Œå…¨ç”Ÿæ•ˆã€‚

---

### `default_config.ini` é…ç½®æ–‡ä»¶ç»“æ„å’Œä¸»è¦é…ç½®é¡¹

#### 1. `[meta]` - å…ƒæ•°æ®å’Œå…¨å±€è®¾ç½®

* **`name`**, **`author`**, **`configVersion`**: æè¿°æ€§ä¿¡æ¯å’Œé…ç½®ç‰ˆæœ¬ã€‚
* **`ModuleRootPath`**: ã€**éå¸¸é‡è¦**ã€‘æ¨¡å—åœ¨è®¾å¤‡ä¸Šçš„å®é™…å®‰è£…æ ¹ç›®å½•ã€‚å¦‚æœç•™ç©ºï¼Œç¨‹åºä¼šå°è¯•æ¨æ–­ï¼Œä½†å»ºè®®æ˜ç¡®è®¾ç½®ï¼ˆä¾‹å¦‚ `/data/adb/modules/YukiCpuScheduler`ï¼‰ã€‚
* **`loglevel`**: æ—¥å¿—çº§åˆ« (`TRACE`, `DEBUG`, `INFO`, `WARN`, `ERROR`, `CRITICAL`, `OFF`)ã€‚
* **`screen_on_mode`**: å±å¹•ç‚¹äº®æ—¶åº”ç”¨çš„é»˜è®¤è°ƒåº¦æ¨¡å¼åç§° (å¯¹åº”åç»­å®šä¹‰çš„æ¨¡å¼èŠ‚å)ã€‚
* **`screen_off_mode`**: å±å¹•å…³é—­æ—¶åº”ç”¨çš„é»˜è®¤è°ƒåº¦æ¨¡å¼åç§°ã€‚
* **`EnablePerAppProfile`**: æ˜¯å¦å¯ç”¨ `app_profiles.ini` æ–‡ä»¶ (`true` æˆ– `false`)ã€‚

#### 2. `[monitor]` - ç›‘æ§ç›¸å…³è®¾ç½®

* **`ScreenStateMethod`**: æ£€æµ‹å±å¹•çŠ¶æ€çš„æ–¹æ³• (`DUMPSYS_POWER` æˆ– `SYSFS`)ã€‚
* **`ScreenStateSysfsPath`**: è‹¥ `ScreenStateMethod = SYSFS`ï¼Œåˆ™æŒ‡å®šsysfsèŠ‚ç‚¹è·¯å¾„ã€‚
* **`ScreenCheckIntervalMs`**: å±å¹•çŠ¶æ€æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚
* **`AppCheckIntervalMs`**: å‰å°åº”ç”¨åˆ‡æ¢æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚
* **`MainLoopSleepSec`**: æœåŠ¡ä¸»å¾ªç¯ä¼‘çœ æ—¶é—´ï¼ˆç§’ï¼‰ã€‚
* **`EnterStandbyDelayMs`**: æ¯å±åï¼Œå»¶è¿Ÿå¤šä¹…æœåŠ¡è¿›å…¥å®šä¹‰çš„â€œå¾…æœºæ¨¡å¼â€ï¼ˆæš‚åœAppWatcherç­‰ï¼‰ã€‚

#### 3. `[monitor_tuning]` - ç›‘æ§è°ƒä¼˜å‚æ•°

æœ¬èŠ‚ç”¨äºå¾®è°ƒæœåŠ¡åœ¨å¯åŠ¨åˆæœŸæ¢æµ‹ä¾èµ–æœåŠ¡ä»¥åŠå¸¸è§„ç›‘æ§æ—¶æ‰§è¡Œ `dumpsys` å‘½ä»¤çš„å‚æ•°ã€‚
* **`InitialProbeMaxRetries`**: æœåŠ¡å¯åŠ¨æ—¶ï¼Œå¯¹ä¾èµ–ç³»ç»ŸæœåŠ¡è¿›è¡Œå°±ç»ªçŠ¶æ€æ¢æµ‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚
* **`InitialProbeDelayMs`**: æ¯æ¬¡åˆå§‹æœåŠ¡å°±ç»ªæ¢æµ‹å°è¯•ä¹‹é—´çš„å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ã€‚
* **`DumpsysPowerProbeCommand`**: ç”¨äºæ¢æµ‹ `PowerManagerService` æ˜¯å¦å°±ç»ªçš„ `dumpsys` å‘½ä»¤ã€‚
* **`DumpsysPowerMonitorCommand`**: ç”¨äºå¸¸è§„ç›‘æ§å±å¹•çŠ¶æ€çš„ `dumpsys power` å‘½ä»¤ã€‚
* **`DumpsysPowerMonitorRetries`**: å¸¸è§„ç›‘æ§æ—¶ `dumpsys power` å‘½ä»¤å¤±è´¥åçš„é‡è¯•æ¬¡æ•°ã€‚
* **`DumpsysPowerMonitorDelayMs`**: å¸¸è§„ç›‘æ§æ—¶ `dumpsys power` å‘½ä»¤å¤±è´¥åçš„é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ã€‚
* **`DumpsysActivityProbeCommand`**: ç”¨äºæ¢æµ‹ `ActivityManagerService` æ˜¯å¦å°±ç»ªçš„ `dumpsys` å‘½ä»¤ã€‚
* **`DumpsysActivityMonitorCommand`**: ç”¨äºå¸¸è§„ç›‘æ§å‰å°åº”ç”¨çš„ `dumpsys activity` å‘½ä»¤ (ä¾‹å¦‚ `dumpsys activity activities` æˆ– `dumpsys activity top -c`)ã€‚
* **`DumpsysActivityMonitorRetries`**: å¸¸è§„ç›‘æ§æ—¶ `dumpsys activity` å‘½ä»¤å¤±è´¥åçš„é‡è¯•æ¬¡æ•°ã€‚
* **`DumpsysActivityMonitorDelayMs`**: å¸¸è§„ç›‘æ§æ—¶ `dumpsys activity` å‘½ä»¤å¤±è´¥åçš„é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ã€‚

#### 4. `[function]` - ä¸»è¦åŠŸèƒ½å¼€å…³

ä¸€ç³»åˆ—å¸ƒå°”å€¼ (`true` æˆ– `false`)ï¼Œç”¨äºå¯ç”¨æˆ–ç¦ç”¨å„é¡¹æ ¸å¿ƒä¼˜åŒ–åŠŸèƒ½ã€‚
* **`CpuFreqGovControl`**: CPUé¢‘ç‡å’Œè°ƒé€Ÿå™¨æ§åˆ¶ã€‚
* **`UclampControl`**: Cgroup Uclampå€¼æ§åˆ¶ã€‚
* **`CpusetControl`**: Cgroup Cpusetæ ¸å¿ƒç»‘å®šæ§åˆ¶ã€‚
* **`AffinitySetter`**: ä¼ ç»ŸCgroupçº§åˆ«CPUäº²å’Œæ€§è®¾ç½®ã€‚**æ³¨æ„**ï¼šå¦‚æœä¸‹é¢çš„ `ThreadAffinityControl` è¢«å¯ç”¨å¹¶å¤„äºæ´»åŠ¨æ¨¡å¼ï¼Œæ­¤é¡¹å°†è¢«å¿½ç•¥ã€‚
* **`AdjIOScheduler`**: I/Oè°ƒåº¦å™¨è°ƒæ•´ã€‚
* **`IO_optimization`**: å…¶ä»–I/Oä¼˜åŒ–ã€‚
* **`EasScheduler`**: EASå†…æ ¸å‚æ•°è®¾ç½®ã€‚
* **`AppLaunchBoost`**: åº”ç”¨å¯åŠ¨åŠ é€ŸåŠŸèƒ½ã€‚

#### 5. `[CoreFramework]` - CPUæ ¸å¿ƒæ¡†æ¶è·¯å¾„é…ç½®

å®šä¹‰ä¸åŒCPUæ ¸å¿ƒç°‡çš„`cpufreq`é©±åŠ¨ä»£è¡¨æ€§è·¯å¾„ï¼Œå½±å“æ ¸å¿ƒç±»å‹è‡ªåŠ¨æ£€æµ‹ä¸æ˜ å°„ã€‚
* **`SmallCorePath`**, **`MediumCorePath`**, **`BigCorePath`**, **`SuperBigCorePath`**:
    * å€¼å¯ä»¥æ˜¯ `auto` (æ¨èï¼Œç¨‹åºè‡ªåŠ¨åŸºäº`cpuinfo_max_freq`æ£€æµ‹), CPUç´¢å¼•å· (å¦‚ `0`), å®Œæ•´çš„cpufreqç­–ç•¥è·¯å¾„ (å¦‚ `/sys/devices/system/cpu/cpu0/cpufreq`), æˆ– `-1` (ç¦ç”¨æ­¤æ ¸å¿ƒç±»å‹çš„è·¯å¾„é…ç½®ï¼Œä¸æ¨èé™¤éç‰¹æ®Šæƒ…å†µ)ã€‚
    * `auto` æ¨¡å¼ä¸‹ï¼Œç¨‹åºä¼šè‡ªåŠ¨è¯†åˆ«æ ¸å¿ƒç°‡ã€‚å¦‚æœæ‰‹åŠ¨æŒ‡å®šè·¯å¾„æ— æ•ˆï¼Œè¯¥æ ¸å¿ƒç±»å‹å°†æ— ä»£è¡¨æ€§è°ƒé¢‘è·¯å¾„ã€‚

#### 6. `[IO_Settings]` - I/Oè°ƒåº¦ç›¸å…³è®¾ç½®

* **`BlockDevice`**: ç›®æ ‡å—è®¾å¤‡åç§° (`auto` è‡ªåŠ¨æ£€æµ‹ï¼Œæˆ–æ‰‹åŠ¨æŒ‡å®šå¦‚ `sda`, `mmcblk0`)ã€‚
* **`Scheduler`**: æœŸæœ›è®¾ç½®çš„I/Oè°ƒåº¦å™¨åç§° (ä¾‹å¦‚ `bfq`, `kyber`, `none` ç­‰)ã€‚
* **`ReadAheadKb`**: (å¯é€‰) å—è®¾å¤‡çš„é¢„è¯»å¤§å°ï¼ˆKBï¼‰ã€‚

#### 7. `[EasSettings]` å’Œ `[EasSchedulerValue]` - EASå‚æ•°è®¾ç½®

è°ƒæ•´å†…æ ¸Energy Aware Scheduling (EAS) ç›¸å…³å‚æ•°ã€‚
* **`[EasSettings]` `BasePaths`**: é€—å·åˆ†éš”çš„EASå‚æ•°åŸºç¡€sysfsè·¯å¾„åˆ—è¡¨ã€‚
* **`[EasSchedulerValue]`**: å®šä¹‰è¦è®¾ç½®çš„EASå‚æ•°åŠå…¶å€¼ (ä¾‹å¦‚ `sched_energy_aware = 1`)ã€‚å‚æ•°åä¼šä¸ `BasePaths` ä¸­çš„è·¯å¾„ç»„åˆå°è¯•å†™å…¥ã€‚

#### 8. `[CgroupPaths]` - Cgroupè·¯å¾„å®šä¹‰

å®šä¹‰å„ç±»cgroupçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„æˆ–è·¯å¾„å‰ç¼€ã€‚
* **`XxxCpuCtlPathPrefix`**: Uclampè®¾ç½®çš„cgroupè·¯å¾„å‰ç¼€ (ä¾‹å¦‚ `TopAppCpuCtlPathPrefix = "/dev/cpuctl/top-app"`)ã€‚åœ¨å…¶åä¼šè¿½åŠ  `/cpu.uclamp.min` ç­‰ã€‚
* **`XxxCpusetPath`**: Cpusetè®¾ç½®çš„cgroupè·¯å¾„ (ä¾‹å¦‚ `BackgroundCpusetPath = "/dev/cpuset/background"`)ã€‚åœ¨å…¶åä¼šè¿½åŠ  `/cpus` æˆ– `/tasks`ã€‚
    * æ”¯æŒçš„ `Xxx` å‰ç¼€æœ‰ `TopApp`, `Foreground`, `Background`, `SystemBg`, `Restricted`ã€‚

#### 9. `[CpusetSettings]` - é»˜è®¤Cpusetæ ¸å¿ƒç»‘å®š

ä¸ºcgroupç±»åˆ«è®¾ç½®é»˜è®¤çš„CPUæ ¸å¿ƒç»‘å®šã€‚è¿™äº›è®¾ç½®å¯ä»¥è¢«ç‰¹å®šæ¨¡å¼ä¸­çš„ `Cpuset_CgroupCategoryKey`è¦†ç›–ã€‚
* é”®: cgroupç±»åˆ«å (ä¾‹å¦‚ `TopApp`, `Background`ï¼Œå¯¹åº”`[CgroupPaths]`ä¸­çš„å‰ç¼€)ã€‚
* å€¼: CPUæ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²ã€‚**æ”¯æŒæ ¸å¿ƒç±»å‹åç§°** (å¦‚ "SmallCore", "BigCore", "SuperBigCore"), ç‰¹æ®Šå…³é”®å­— (å¦‚ "SmallestSingle", "AllCores"), ä»¥åŠä¼ ç»Ÿæ•°å­—å’ŒèŒƒå›´ (å¦‚ "0-3", "7")ã€‚è¿™äº›ç¬¦å·åç”± `CpuUtils::CpuListParser` è§£æã€‚
    * ç¨‹åºä¼šæ ¹æ® `[CoreFramework]` çš„æ£€æµ‹ç»“æœåŠ¨æ€è§£ææ ¸å¿ƒç±»å‹åç§°ã€‚è‹¥é…ç½®ä¸­æŒ‡å®šçš„æ ¸å¿ƒç±»å‹åç§°åœ¨å½“å‰è®¾å¤‡æœªæ£€æµ‹åˆ°ï¼Œè¯¥åç§°å°†è¢«è·³è¿‡ã€‚
    * ç¤ºä¾‹: `TopApp = "MediumCore,BigCore,SuperBigCore"`

#### 10. `[AffinitySettings]` - CPUäº²å’Œæ€§è®¾ç½® (ä¼ ç»ŸCgroupçº§åˆ«)

ä¸ºcgroupç±»åˆ«ï¼ˆæˆ–ç»“åˆæ¨¡å¼ï¼‰è®¾ç½®CPUäº²å’Œæ€§ã€‚**æ³¨æ„**ï¼šå¦‚æœ `[ThreadAffinityControl] Enable = true` ä¸” `Mode` ä¸æ˜¯ `off`ï¼Œåˆ™æ­¤èŠ‚çš„è®¾ç½®å°†è¢«å¿½ç•¥ã€‚
* æ ¼å¼ä¸å€¼çš„è§£æé€»è¾‘åŒ `[CpusetSettings]` (åŒæ ·æ”¯æŒæ ¸å¿ƒç±»å‹åç§°å’Œè·³è¿‡é€»è¾‘)ã€‚
    * é»˜è®¤é”®: `Affinity_CgroupCategoryKey = "æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²"` (ä¾‹å¦‚ `Affinity_Background = "SmallCore"`)ã€‚
    * æ¨¡å¼ç‰¹å®šé”®: `Affinity_CgroupCategoryKey_ModeName = "æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²"` (ä¾‹å¦‚ `Affinity_TopApp_performance = "BigCore"`)ã€‚

#### 11. `[AppLaunchBoostSettings]` - åº”ç”¨å¯åŠ¨åŠ é€Ÿè®¾ç½®

æ§åˆ¶åº”ç”¨å¯åŠ¨åŠ é€ŸåŠŸèƒ½ã€‚
* **`Enable`**: æ˜¯å¦å¯ç”¨ (`true`/`false`)ã€‚
* **`BoostDurationMs`**: åŠ é€ŸæŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚
* **`BoostModeName`**: åŠ é€Ÿæ—¶åº”ç”¨çš„è°ƒåº¦æ¨¡å¼åç§° (å¿…é¡»æ˜¯æœ¬é…ç½®æ–‡ä»¶ä¸­å·²å®šä¹‰çš„æ¨¡å¼)ã€‚
* **`CoolDownMs`**: ä¸€æ¬¡åŠ é€Ÿç»“æŸåï¼Œåˆ°ä¸‹ä¸€æ¬¡å¯ä»¥è§¦å‘åŠ é€Ÿçš„å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚
* **`ExcludedApps`**: é€—å·åˆ†éš”çš„ä¸è§¦å‘å¯åŠ¨åŠ é€Ÿçš„åº”ç”¨åŒ…ååˆ—è¡¨ã€‚

#### 12. `[ThreadAffinityControl]` - çº¿ç¨‹çº§åˆ«æ ¸å¿ƒåˆ†é…æ§åˆ¶

å…¨å±€æ§åˆ¶æ–°çš„çº¿ç¨‹çº§åˆ«æ ¸å¿ƒåˆ†é…åŠŸèƒ½ã€‚
* **`Enable`**: (`true`/`false`) æ€»å¼€å…³ï¼Œå¯ç”¨æˆ–ç¦ç”¨ `ThreadAffinityManager`ã€‚
* **`Mode`**: æ ¸å¿ƒåˆ†é…æ¨¡å¼ï¼Œå¯é€‰å€¼ï¼š
    * `off`: å®Œå…¨ç¦ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ ¸å¿ƒåˆ†é…ã€‚
    * `manual`: å®Œå…¨æ ¹æ®ç”¨æˆ·åœ¨ `app_profiles.ini` ä¸­ä¸ºç‰¹å®šåº”ç”¨å®šä¹‰çš„ `ThreadRule_` è§„åˆ™åˆ†é…æ ¸å¿ƒã€‚
    * `automatic`: å®Œå…¨æ ¹æ®çº¿ç¨‹çš„å®æ—¶CPUå ç”¨ç‡åŠ¨æ€åˆ†é…æ ¸å¿ƒï¼Œä½¿ç”¨ `[DynamicThreadAffinity]` èŠ‚ä¸­çš„å‚æ•°ã€‚
    * `hybrid`: æ··åˆæ¨¡å¼ã€‚ä¼˜å…ˆåº”ç”¨ `app_profiles.ini` ä¸­çš„ `ThreadRule_` æ‰‹åŠ¨è§„åˆ™ï¼›å¯¹äºåº”ç”¨å†…æœªåŒ¹é…ä»»ä½•æ‰‹åŠ¨è§„åˆ™çš„çº¿ç¨‹ï¼Œåˆ™å°è¯•åº”ç”¨ `[DynamicThreadAffinity]` çš„è‡ªåŠ¨åŠ¨æ€åˆ†é…é€»è¾‘ã€‚
* **`TargetProcessName`**: (å¯é€‰) å­—ç¬¦ä¸²ã€‚å¦‚æœè®¾ç½®äº†è¿›ç¨‹åæˆ–åŒ…å (ä¾‹å¦‚ `com.example.game` æˆ– `surfaceflinger`)ï¼Œåˆ™ `ThreadAffinityManager` çš„è‡ªåŠ¨å’Œæ‰‹åŠ¨ï¼ˆå¦‚æœè§„åˆ™ä¸æ­¤ååŒ¹é…ï¼‰æ¨¡å¼å°†ä¸»è¦å…³æ³¨æ­¤æŒ‡å®šè¿›ç¨‹çš„çº¿ç¨‹ã€‚å¦‚æœç•™ç©ºï¼Œåˆ™ï¼š
    * `automatic` å’Œ `hybrid` æ¨¡å¼ä¸‹çš„è‡ªåŠ¨åˆ†é…éƒ¨åˆ†ï¼Œé€šå¸¸ä¼šç›‘æ§å½“å‰å‰å°åº”ç”¨çš„çº¿ç¨‹ã€‚
    * `manual` å’Œ `hybrid` æ¨¡å¼ä¸‹çš„æ‰‹åŠ¨è§„åˆ™éƒ¨åˆ†ï¼Œä»ç„¶ä¾èµ–äº `app_profiles.ini` ä¸­æ¯ä¸ªèŠ‚ï¼ˆåŒ…åï¼‰ä¸‹çš„ `ThreadRule_`ã€‚

#### 13. `[DynamicThreadAffinity]` - è‡ªåŠ¨åŠ¨æ€çº¿ç¨‹äº²å’Œæ€§è®¾ç½®

å½“ `[ThreadAffinityControl] Mode` ä¸º `automatic` æˆ– `hybrid` æ—¶ï¼Œæœ¬èŠ‚å‚æ•°ç”¨äºæ§åˆ¶çº¿ç¨‹çš„åŠ¨æ€æ ¸å¿ƒåˆ†é…ã€‚
* **`ScanIntervalMs`**: çº¿ç¨‹CPUå ç”¨ç‡çš„æ‰«æå’Œåˆ†é…å†³ç­–çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚
* **`HighUsageThreshold`**, **`MediumUsageThreshold`**: CPUå ç”¨ç‡ç™¾åˆ†æ¯”é˜ˆå€¼ (0-100)ï¼Œç”¨äºå°†çº¿ç¨‹åˆ†ç±»ä¸ºé«˜ã€ä¸­ã€ä½å ç”¨ã€‚
* **`HighUsageTargetCores`**, **`MediumUsageTargetCores`**, **`LowUsageTargetCores`**: ä¸ºä¸åŒå ç”¨ç‡ç±»åˆ«çš„çº¿ç¨‹æŒ‡å®šçš„ç¬¦å·åŒ–ç›®æ ‡æ ¸å¿ƒåˆ—è¡¨ï¼ˆä¾‹å¦‚ `"SuperBigCore,BigCore"`, `"MediumCore"`, `"SmallCore"`ï¼‰ã€‚ç”± `CpuUtils::CpuListParser` è§£æã€‚
* **`StickHighUsageToSingleCore`**, **`StickMediumUsageToSingleCore`**: (`true`/`false`) æ˜¯å¦å°†é«˜/ä¸­å ç”¨çº¿ç¨‹ä¸¥æ ¼ç»‘å®šåˆ°å…¶ç›®æ ‡æ ¸å¿ƒç»„ä¸­çš„**å•ä¸ª**æ ¸å¿ƒã€‚å¦‚æœä¸º `false`ï¼Œåˆ™çº¿ç¨‹äº²å’Œæ€§ä¼šè®¾ä¸ºç›®æ ‡æ ¸å¿ƒç»„çš„å…¨éƒ¨æ ¸å¿ƒã€‚
* **`HighUsageCoreSelectionPolicy`**, **`MediumUsageCoreSelectionPolicy`**: å¦‚æœ `Stick...ToSingleCore` ä¸º `true` ä¸”ç›®æ ‡æ ¸å¿ƒç»„æœ‰å¤šä¸ªæ ¸å¿ƒï¼Œæ­¤ç­–ç•¥å†³å®šå¦‚ä½•é€‰æ‹©é‚£ä¸€ä¸ªæ ¸å¿ƒã€‚å¯é€‰å€¼: `"first"` (é€‰æ‹©åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ª), `"round_robin"` (åŸºäºçº¿ç¨‹TIDå“ˆå¸Œçš„è½®è¯¢é€‰æ‹©), `"least_loaded"` (é«˜çº§ï¼Œé€‰æ‹©è´Ÿè½½æœ€ä½çš„ï¼Œå¯èƒ½å°šæœªå®Œå…¨å®ç°æˆ–ä¾èµ–ç‰¹å®šå†…æ ¸æ”¯æŒ)ã€‚
* **`CoolDownMsAfterMigration`**: çº¿ç¨‹è¢«è‡ªåŠ¨è¿ç§»æ ¸å¿ƒåï¼Œåœ¨å¤šå°‘æ¯«ç§’å†…ä¸å†å¯¹å…¶è¿›è¡Œä¸‹ä¸€æ¬¡è‡ªåŠ¨è¿ç§»ï¼Œä»¥é¿å…è¿‡äºé¢‘ç¹çš„åˆ‡æ¢ã€‚

#### 14. `[ManualThreadAffinity]` - æ‰‹åŠ¨é™æ€çº¿ç¨‹äº²å’Œæ€§è®¾ç½®

å½“ `[ThreadAffinityControl] Mode` ä¸º `manual` æˆ– `hybrid` æ—¶ï¼Œæœ¬èŠ‚å‚æ•°æä¾›å…¨å±€é»˜è®¤å€¼ã€‚
* **`DefaultAffinityForUnmatchedGlobal`**: ç¬¦å·åŒ–æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²ã€‚ç”¨äºé‚£äº›åœ¨ `app_profiles.ini` ä¸­æ²¡æœ‰ç‰¹å®š `ThreadRule_` (åŒ…æ‹¬ `ThreadRule_Default`) è¦†ç›–çš„çº¿ç¨‹ã€‚
    * åœ¨ `manual` æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨æ²¡æœ‰è‡ªå·±çš„ `ThreadRule_Default`ï¼Œå…¶æœªåŒ¹é…çº¿ç¨‹ä¼šä½¿ç”¨æ­¤å…¨å±€é»˜è®¤ã€‚
    * åœ¨ `hybrid` æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨æ²¡æœ‰è‡ªå·±çš„ `ThreadRule_Default`ï¼Œå…¶æœªåŒ¹é…çº¿ç¨‹ä¼šå…ˆå°è¯•æ­¤å…¨å±€é»˜è®¤ï¼›å¦‚æœæ­¤å…¨å±€é»˜è®¤ä¹Ÿæ˜¯ç©ºæˆ–æœªå®šä¹‰ï¼ˆæˆ–è§£æä¸ºå…è®¸æ‰€æœ‰æ ¸å¿ƒï¼‰ï¼Œåˆ™è¿™äº›çº¿ç¨‹å¯èƒ½ä¼šè¿›å…¥è‡ªåŠ¨åŠ¨æ€åˆ†é…é€»è¾‘ã€‚
    * ä¾‹å¦‚: `DefaultAffinityForUnmatchedGlobal = "AllCores"`

#### 15. `[UclampSettings_Default]` - å…¨å±€Uclampé»˜è®¤å€¼

ä¸ºä¸åŒcgroupç±»åˆ«å®šä¹‰Uclampå‚æ•°çš„é»˜è®¤å€¼ã€‚å¦‚æœæŸä¸ªæ¨¡å¼ï¼ˆå¦‚ä¸‹é¢çš„æ¨¡å¼å®šä¹‰ï¼‰ä¸­æ²¡æœ‰ä¸ºç‰¹å®šcgroupç±»åˆ«æŒ‡å®šUclampå‚æ•°ï¼Œåˆ™ä¼šä½¿ç”¨æ­¤å¤„çš„é»˜è®¤å€¼ã€‚
* é”®æ ¼å¼: `UclampMin_CgroupCategoryKey`, `UclampMax_CgroupCategoryKey`, `UclampLatencySensitive_CgroupCategoryKey`ã€‚
* `CgroupCategoryKey` å¯ä»¥æ˜¯ `TopApp`, `Foreground`, `Background`, `SystemBg`, `Restricted`ã€‚
* ç¤ºä¾‹: `UclampMin_TopApp = 0`, `UclampMax_Background = 50`

#### 16. æ¨¡å¼å®šä¹‰ (ä¾‹å¦‚ `[powersave]`, `[balance]`, `[performance]`, `[fast]`)

å®šä¹‰ä¸åŒåœºæ™¯ä¸‹çš„ç³»ç»Ÿè¡Œä¸ºã€‚æ¯ä¸ªæ¨¡å¼éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ã€‚
* åœ¨ä¸€ä¸ªæ¨¡å¼èŠ‚å†…:
    * **è°ƒé€Ÿå™¨è®¾ç½®**:
        * `ScalingGovernor = governor_name` (ä¾‹å¦‚ `schedutil`, `performance`, `powersave`, `walt`, `uag`)ï¼šæ­¤æ¨¡å¼ä¸‹æ‰€æœ‰æ ¸å¿ƒç°‡çš„é»˜è®¤ä¸»è°ƒé€Ÿå™¨ã€‚
        * `FallbackScalingGovernor = governor_name`: å¦‚æœä¸»è°ƒé€Ÿå™¨è®¾ç½®å¤±è´¥ï¼Œåˆ™å°è¯•æ­¤å¤‡é€‰è°ƒé€Ÿå™¨ã€‚
        * `CoreTypeScalingGovernor = governor_name`: å¯ä¸ºç‰¹å®šæ ¸å¿ƒç±»å‹ (å¦‚ `SmallCoreScalingGovernor`) æŒ‡å®šä¸»è°ƒé€Ÿå™¨ï¼Œè¦†ç›–ä¸Šé¢çš„å…¨å±€æ¨¡å¼é»˜è®¤ã€‚
        * `CoreTypeFallbackScalingGovernor = governor_name`: ç‰¹å®šæ ¸å¿ƒç±»å‹çš„å¤‡é€‰è°ƒé€Ÿå™¨ã€‚
    * **é¢‘ç‡è®¾ç½®**:
        * `CoreTypeMaxFreq = frequency_in_kHz | max`: ç‰¹å®šæ ¸å¿ƒç±»å‹çš„æœ€å¤§é¢‘ç‡ã€‚`max` è¡¨ç¤ºä½¿ç”¨å†…æ ¸å…è®¸çš„æœ€é«˜é¢‘ç‡ã€‚
        * `CoreTypeMinFreq = frequency_in_kHz | min`: ç‰¹å®šæ ¸å¿ƒç±»å‹çš„æœ€å°é¢‘ç‡ã€‚`min` è¡¨ç¤ºä½¿ç”¨å†…æ ¸å…è®¸çš„æœ€ä½é¢‘ç‡ã€‚
    * **ç‰¹å®šè°ƒé€Ÿå™¨å‚æ•° (é‡è¦ï¼)**ï¼š
        * è¿™äº›å‚æ•°ä»…å½“å¯¹åº”æ ¸å¿ƒç°‡**æœ€ç»ˆç”Ÿæ•ˆ**çš„è°ƒé€Ÿå™¨æ˜¯å…¶ç›®æ ‡ç±»å‹æ—¶æ‰ä¼šè¢«åº”ç”¨ã€‚
        * **Schedutil ç‰¹å®šå‚æ•°**: é”®åæ ¼å¼ `CoreTypeSchedutilParameterNameInCamelCase` (ä¾‹å¦‚ `SmallCoreSchedutilUpRateLimitUs`, `BigCoreSchedutilHispeedFreq`)ã€‚ç¨‹åºä¼šå°† `ParameterNameInCamelCase` è½¬æ¢ä¸ºä¸‹åˆ’çº¿å½¢å¼çš„èŠ‚ç‚¹åï¼ˆå¦‚ `up_rate_limit_us`ï¼‰å¹¶å°è¯•å†™å…¥åˆ° `/sys/.../cpufreq/policyX/schedutil/` ç›®å½•ä¸‹ã€‚
        * **WALT ç‰¹å®šå‚æ•°**: é”®åæ ¼å¼ `CoreTypeWaltParameterNameInCamelCase` (ä¾‹å¦‚ `MediumCoreWaltTargetLoads`)ã€‚å†™å…¥åˆ° `/sys/.../cpufreq/policyX/walt/` ç›®å½•ã€‚
        * **UAG ç‰¹å®šå‚æ•°**: é”®åæ ¼å¼ `CoreTypeUagParameterNameInCamelCase` (ä¾‹å¦‚ `BigCoreUagStallAware`)ã€‚å†™å…¥åˆ° `/sys/.../cpufreq/policyX/uag/` ç›®å½•ã€‚
    * **æ¨¡å¼ç‰¹å®šçš„Uclampè®¾ç½®**: é”®åæ ¼å¼ `UclampMin_CgroupCategoryKey`, `UclampMax_CgroupCategoryKey`, `UclampLatencySensitive_CgroupCategoryKey` (ä¾‹å¦‚ `UclampMin_TopApp = 10`)ã€‚è¿™äº›ä¼šè¦†ç›– `[UclampSettings_Default]` ä¸­çš„å€¼ã€‚
    * **æ¨¡å¼ç‰¹å®šçš„Cpuset/Affinityè®¾ç½® (å¯é€‰)**:
        * `Cpuset_CgroupCategoryKey = "æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²"` (è¦†ç›– `[CpusetSettings]` ä¸­çš„åŒåé¡¹)ã€‚
        * `Affinity_CgroupCategoryKey = "æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²"` (è¦†ç›– `[AffinitySettings]` ä¸­çš„åŒåé¡¹ï¼Œä½†åŒæ ·å— `ThreadAffinityControl` çš„å½±å“)ã€‚
    * **ç›´æ¥å†™å…¥SysfsèŠ‚ç‚¹**: `SysfsPath_/path/to/sysfs/node = value_to_write` (è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„)ã€‚è¿™äº›å†™å…¥æ“ä½œé€šå¸¸åœ¨å…¶ä»–å‚æ•°è®¾ç½®ä¹‹åæ‰§è¡Œã€‚

---

## âš™ï¸ å¦‚ä½•æ‰‹åŠ¨é…ç½® `app_profiles.ini`

æœ¬æ–‡ä»¶ç”¨äºå®šä¹‰ç‰¹å®šåº”ç”¨ç¨‹åºåœ¨å‰å°è¿è¡Œæ—¶çš„ä¸“å±è°ƒåº¦è¡Œä¸ºï¼Œå®ƒå¯ä»¥è¦†ç›– `default_config.ini`ï¼ˆåŠå¤„ç†å™¨ç‰¹å®šé…ç½®ï¼‰ä¸­çš„è®¾å®šã€‚

**é‡è¦æç¤º:**

* ç¡®ä¿ `default_config.ini` ä¸­çš„ `[meta] EnablePerAppProfile = true`ã€‚
* é…ç½®ä¼˜å…ˆçº§ï¼š`app_profiles.ini` ä¸­é’ˆå¯¹æŸåº”ç”¨çš„è®¾ç½® > æ¨¡å¼ä¸­é’ˆå¯¹æŸåº”ç”¨çš„å‚æ•°ï¼ˆå¦‚æœæœ‰è¿™ç§ç»†åˆ†ï¼Œç›®å‰ä¸»è¦é€šè¿‡ç›´æ¥è¦†ç›–æ¨¡å¼å‚æ•°å®ç°ï¼‰ > å¤„ç†å™¨ç‰¹å®šé…ç½®ä¸­çš„æ¨¡å¼å‚æ•° > `default_config.ini` ä¸­çš„æ¨¡å¼å‚æ•°ã€‚

---

### `app_profiles.ini` é…ç½®æ–‡ä»¶ç»“æ„å’Œä¸»è¦é…ç½®é¡¹

æ–‡ä»¶ç”±å¤šä¸ªèŠ‚ç»„æˆï¼Œæ¯ä¸ªèŠ‚çš„åç§°æ˜¯ç›®æ ‡åº”ç”¨çš„**åŒ…å**ã€‚

**åœ¨ä¸€ä¸ªåº”ç”¨èŠ‚å†… (ä¾‹å¦‚ `[com.tencent.tmgp.sgame]`)**:

1.  **å¼ºåˆ¶æ¨¡å¼åˆ‡æ¢**:
    * `mode = mode_name`
    * æŒ‡å®šæ­¤åº”ç”¨åœ¨å‰å°æ—¶ï¼Œå¼ºåˆ¶ä½¿ç”¨åä¸º `mode_name` çš„è°ƒåº¦æ¨¡å¼ï¼ˆè¯¥æ¨¡å¼å¿…é¡»åœ¨ `default_config.ini` æˆ–å¤„ç†å™¨ç‰¹å®šé…ç½®ä¸­å·²å®šä¹‰ï¼‰ã€‚è¿™å°†è¦†ç›– `default_config.ini` ä¸­ `[meta] screen_on_mode` å®šä¹‰çš„æ¨¡å¼ã€‚
    * ç¤ºä¾‹: `mode = performance`

2.  **è¦†ç›–å½“å‰ç”Ÿæ•ˆæ¨¡å¼çš„å‚æ•°**:
    * æ‚¨å¯ä»¥åˆ—å‡ºä»»ä½•åœ¨ `default_config.ini` æ¨¡å¼å®šä¹‰ä¸­æœ‰æ•ˆçš„å‚æ•°é”®åï¼Œå¹¶ä¸ºå…¶èµ‹äºˆæ–°å€¼ã€‚
    * **å¦‚æœä¸Šé¢æŒ‡å®šäº† `mode = ...`**ï¼šé‚£ä¹ˆè¿™é‡Œåˆ—å‡ºçš„å‚æ•°ä¼šè¦†ç›–é‚£ä¸ªè¢«å¼ºåˆ¶æŒ‡å®šçš„æ¨¡å¼ä¸­çš„å¯¹åº”å‚æ•°ï¼Œä½†ä»…å¯¹æ­¤åº”ç”¨ç”Ÿæ•ˆã€‚
    * **å¦‚æœæ²¡æœ‰æŒ‡å®š `mode = ...`**ï¼šé‚£ä¹ˆæ­¤åº”ç”¨ä¼šä½¿ç”¨å…¨å±€çš„ `screen_on_mode`ã€‚è¿™é‡Œåˆ—å‡ºçš„å‚æ•°ä¼šè¦†ç›–é‚£ä¸ªå…¨å±€ `screen_on_mode` ä¸­çš„å¯¹åº”å‚æ•°ï¼Œä½†ä»…å¯¹æ­¤åº”ç”¨ç”Ÿæ•ˆã€‚
    * å‚æ•°é”®åç¤ºä¾‹ (ä¸ `default_config.ini` æ¨¡å¼å®šä¹‰ä¸­çš„é”®åä¸€è‡´)ï¼š
        * `SmallCoreMaxFreq = 2000000`
        * `BigCoreMinFreq = 1500000`
        * `MediumCoreSchedutilHispeedLoad = 80`
        * `UclampMin_TopApp = 50` (æ³¨æ„ï¼šè¿™ä¼šå½±å“è¿è¡Œæ­¤åº”ç”¨æ—¶å…¶æ‰€å±çš„TopApp Cgroupçš„Uclampè®¾ç½®)
        * `Cpuset_TopApp = "4-7"` (åŒæ ·å½±å“æ•´ä¸ªTopApp Cgroupï¼Œéœ€è°¨æ…)
        * `Affinity_TopApp = "6-7"` (ä¼ ç»ŸCgroupçº§åˆ«äº²å’Œæ€§ï¼Œå¦‚æœæœªè¢« `ThreadAffinityControl` ç¦ç”¨)
        * `SysfsPath_/sys/devices/system/cpu/cpu0/cpufreq/schedutil/hispeed_freq = 1200000` (ç›´æ¥å†™å…¥sysfsèŠ‚ç‚¹)

3.  **çº¿ç¨‹çº§åˆ«æ ¸å¿ƒåˆ†é…è§„åˆ™ (Thread Rules)**:
    * è¿™äº›è§„åˆ™ä»…åœ¨ `default_config.ini` ä¸­ `[ThreadAffinityControl] Enable = true` ä¸” `Mode` ä¸º `manual` æˆ– `hybrid` æ—¶ï¼Œç”±æ­¤åº”ç”¨çš„çº¿ç¨‹è§¦å‘ã€‚
    * é”®åæ ¼å¼: `ThreadRule_çº¿ç¨‹åæ¨¡å¼ = "æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²"`
    * **`çº¿ç¨‹åæ¨¡å¼`**:
        * ç²¾ç¡®åç§°: ä¾‹å¦‚ `UnityMain`ï¼Œåˆ™å®Œå…¨åŒ¹é…åä¸º "UnityMain" çš„çº¿ç¨‹ã€‚
        * å‰ç¼€åŒ¹é…: ä¾‹å¦‚ `RenderThread*`ï¼Œåˆ™åŒ¹é…æ‰€æœ‰ä»¥ "RenderThread" å¼€å¤´çš„çº¿ç¨‹åã€‚
    * **`æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²`**: ä¸ `[CpusetSettings]` æˆ– `[AffinitySettings]` ä¸­çš„å€¼æ ¼å¼ç›¸åŒï¼Œæ”¯æŒæ ¸å¿ƒç±»å‹åç§° ("SmallCore", "BigCore0", "SuperBigCore" ç­‰ï¼Œå…¶ä¸­æ•°å­—è¡¨ç¤ºè¯¥ç±»å‹æ ¸å¿ƒä¸­çš„ç¬¬å‡ ä¸ªï¼Œä¾‹å¦‚ `BigCore0` æ˜¯ç¬¬ä¸€ä¸ªå¤§æ ¸)ã€CPU ID ("0", "7")ã€èŒƒå›´ ("0-3")ï¼Œæˆ–å®ƒä»¬çš„ç»„åˆï¼Œç”±é€—å·åˆ†éš”ã€‚è¿™äº›ç”± `CpuUtils::CpuListParser` è§£æã€‚å¦‚æœè®¾å¤‡ä¸Šæ²¡æœ‰é…ç½®çš„æ ¸å¿ƒç±»å‹ï¼Œæˆ–æŒ‡å®šçš„æ ¸å¿ƒç´¢å¼•è¶…å‡ºèŒƒå›´ï¼Œè¯¥éƒ¨åˆ†ä¼šè¢«è·³è¿‡æˆ–è§£æå¤±è´¥ã€‚
        * ç¤ºä¾‹:
            * `ThreadRule_UnityMain = "SuperBigCore0"`
            * `ThreadRule_UnityGfxDeviceW = "BigCore"`
            * `ThreadRule_Job.worker* = "MediumCore"`
            * `ThreadRule_RenderThread* = "BigCore0,BigCore1"`
            * `ThreadRule_binder:* = "0-1"`
    * **åº”ç”¨å†…é»˜è®¤è§„åˆ™**:
        * `ThreadRule_Default = "æ ¸å¿ƒåˆ—è¡¨å­—ç¬¦ä¸²"`
        * ç”¨äºæ­¤åº”ç”¨å†…**å…¶ä»–æœªåŒ¹é…**åˆ°ä¸Šè¿°ä»»ä½•ç‰¹å®š `ThreadRule_çº¿ç¨‹åæ¨¡å¼` è§„åˆ™çš„çº¿ç¨‹ã€‚
        * å¦‚æœæ­¤åº”ç”¨æ²¡æœ‰æä¾› `ThreadRule_Default`ï¼Œåˆ™ä¼šæŸ¥æ‰¾ `default_config.ini` ä¸­ `[ManualThreadAffinity] DefaultAffinityForUnmatchedGlobal` çš„è®¾ç½®ä½œä¸ºå¤‡é€‰ï¼ˆå°¤å…¶æ˜¯åœ¨ `manual` æ¨¡å¼ä¸‹ï¼‰ã€‚åœ¨ `hybrid` æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸¤å¤„éƒ½æ²¡æœ‰ä¸ºçº¿ç¨‹æä¾›æ‰‹åŠ¨è§„åˆ™ï¼Œåˆ™çº¿ç¨‹ä¼šè¿›å…¥è‡ªåŠ¨åŠ¨æ€åˆ†é…é€»è¾‘ã€‚
        * ç¤ºä¾‹: `ThreadRule_Default = "MediumCore,SmallCore"`

    * **é…ç½®ç¤ºä¾‹ (`app_profiles.ini`)**

```ini
; --- ç‹è€…è£è€€ç¤ºä¾‹ ---
[com.tencent.tmgp.sgame]
mode = performance ; æ­¤æ¸¸æˆè¿è¡Œæ—¶ä½¿ç”¨ performance æ¨¡å¼

; è¦†ç›– performance æ¨¡å¼ä¸­çš„å‚æ•° (ä»…å¯¹æ­¤æ¸¸æˆç”Ÿæ•ˆ)
BigCoreMinFreq = 2000000
SuperBigCoreSchedutilUpRateLimitUs = 4000

; çº¿ç¨‹åˆ†é…è§„åˆ™
ThreadRule_UnityMain = "SuperBigCore0"
ThreadRule_UnityGfxDeviceW = "BigCore"
ThreadRule_RenderThread* = "BigCore0,BigCore1"
ThreadRule_bqgThread-* = "SmallCore" ; å‡è®¾è¿™æ˜¯æŸç§åå°é˜Ÿåˆ—çº¿ç¨‹
ThreadRule_Default = "MediumCore" ; æ­¤æ¸¸æˆå†…å…¶ä»–æœªåŒ¹é…çº¿ç¨‹ä½¿ç”¨æ‰€æœ‰ä¸­æ ¸

; --- æŸä¸ªé˜…è¯»åº”ç”¨ ---
[com.example.reader]
mode = powersave
BigCoreMaxFreq = 800000 ; è¿›ä¸€æ­¥é™åˆ¶å¤§æ ¸é¢‘ç‡

; æ­¤é˜…è¯»åº”ç”¨ä¸éœ€è¦ç²¾ç»†çš„çº¿ç¨‹åˆ†é…ï¼Œæ‰€ä»¥æ²¡æœ‰ ThreadRule_
; å¦‚æœå…¨å±€ ThreadAffinityControl Mode æ˜¯ manualï¼Œä¸” DefaultAffinityForUnmatchedGlobal æœ‰æ•ˆï¼Œåˆ™åº”ç”¨å…¨å±€é»˜è®¤ã€‚
; å¦‚æœæ˜¯ hybridï¼Œåˆ™å…¶çº¿ç¨‹ä¼šå°è¯•å…¨å±€é»˜è®¤ï¼Œç„¶åå¯èƒ½è¿›å…¥è‡ªåŠ¨åˆ†é…ã€‚
; å¦‚æœæ˜¯ automaticï¼Œåˆ™å…¶çº¿ç¨‹å®Œå…¨ç”±è‡ªåŠ¨åˆ†é…é€»è¾‘å¤„ç†ã€‚


## ğŸ™ è´¡çŒ®è€…è‡´è°¢

ç‰¹åˆ«æ„Ÿè°¢ä»¥ä¸‹å¼€å‘è€…çš„è´¡çŒ®ï¼ˆæŒ‰åŠ å…¥æ—¶é—´æ’åºï¼‰ï¼š

| è´¡çŒ®è€… | è´¡çŒ®é¢†åŸŸ |
|--------|----------|
| [@AquaPuffğŸ‹](https://github.com/zgquangui) | é…ç½®æ–‡ä»¶çš„ç¼–è¾‘ |

## ğŸ“œ è®¸å¯è¯ (License)

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚


**é…ç½®ç¤ºä¾‹ (`app_profiles.ini`)**

```ini
; --- ç‹è€…è£è€€ç¤ºä¾‹ ---
[com.tencent.tmgp.sgame]
mode = performance ; æ­¤æ¸¸æˆè¿è¡Œæ—¶ä½¿ç”¨ performance æ¨¡å¼

; è¦†ç›– performance æ¨¡å¼ä¸­çš„å‚æ•° (ä»…å¯¹æ­¤æ¸¸æˆç”Ÿæ•ˆ)
BigCoreMinFreq = 2000000
SuperBigCoreSchedutilUpRateLimitUs = 4000

; çº¿ç¨‹åˆ†é…è§„åˆ™
ThreadRule_UnityMain = "SuperBigCore0"
ThreadRule_UnityGfxDeviceW = "BigCore"
ThreadRule_RenderThread* = "BigCore0,BigCore1"
ThreadRule_bqgThread-* = "SmallCore" ; å‡è®¾è¿™æ˜¯æŸç§åå°é˜Ÿåˆ—çº¿ç¨‹
ThreadRule_Default = "MediumCore" ; æ­¤æ¸¸æˆå†…å…¶ä»–æœªåŒ¹é…çº¿ç¨‹ä½¿ç”¨æ‰€æœ‰ä¸­æ ¸

; --- æŸä¸ªé˜…è¯»åº”ç”¨ ---
[com.example.reader]
mode = powersave
BigCoreMaxFreq = 800000 ; è¿›ä¸€æ­¥é™åˆ¶å¤§æ ¸é¢‘ç‡

; æ­¤é˜…è¯»åº”ç”¨ä¸éœ€è¦ç²¾ç»†çš„çº¿ç¨‹åˆ†é…ï¼Œæ‰€ä»¥æ²¡æœ‰ ThreadRule_
; å¦‚æœå…¨å±€ ThreadAffinityControl Mode æ˜¯ manualï¼Œä¸” DefaultAffinityForUnmatchedGlobal æœ‰æ•ˆï¼Œåˆ™åº”ç”¨å…¨å±€é»˜è®¤ã€‚
; å¦‚æœæ˜¯ hybridï¼Œåˆ™å…¶çº¿ç¨‹ä¼šå°è¯•å…¨å±€é»˜è®¤ï¼Œç„¶åå¯èƒ½è¿›å…¥è‡ªåŠ¨åˆ†é…ã€‚
; å¦‚æœæ˜¯ automaticï¼Œåˆ™å…¶çº¿ç¨‹å®Œå…¨ç”±è‡ªåŠ¨åˆ†é…é€»è¾‘å¤„ç†ã€‚




---

